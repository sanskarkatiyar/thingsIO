{% extends "dash/dashboard_base.html" %}

{% block content %}
<br />
<h3>Analytics</h3>

<!-- Snippet modified from: https://getbootstrap.com/docs/4.5/components/navs/ -->
<nav>
  <div class="nav nav-tabs" id="nav-tab" role="tablist">
    <a class="nav-link active" id="nav-export-tab" data-toggle="tab" href="#nav-export" role="tab" aria-controls="nav-export" aria-selected="true">Export</a>
    <a class="nav-link" id="nav-stat1-tab" data-toggle="tab" href="#nav-stat1" role="tab" aria-controls="nav-stat1" aria-selected="false">Moving Average</a>
  </div>
</nav>
<div class="tab-content" id="nav-tabContent">
  <div class="tab-pane fade show active" id="nav-export" role="tabpanel" aria-labelledby="nav-export-tab">
    <div class="container-fluid">
      <div class="row-fluid">
        <br />
        <form method="POST" action="{{ url_for('dash.analytics_request_processor', event_id='export') }}">

          <div class="form-row">
            <div class="form-group col-md-6">
              <label for="exportInputFilename">Filename</label>
              <input type="text" class="form-control" id="exportInputFilename" name="exportInputFilename" value="thingsIO_export" required>
            </div>
            <div class="form-group col-md-6">
              <label for="exportInputFormat">File format</label>
              <select id="exportInputFormat" name="exportInputFormat" class="form-control">
                <option selected>JSON</option>
                <option>CSV</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="checkbox" id="exportInlineCheckboxTimeStamp" value="timestamp" disabled checked>
              <label class="form-check-label" for="exportInlineCheckboxTimeStamp">timestamp (UTC)</label>
            </div>

            {% for k in my_schema %}
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="checkbox" id="exportInlineCheckbox{{ loop.index }}" name="exportFieldsSel" value="{{ k }}">
              <label class="form-check-label" for="exportInlineCheckbox{{ loop.index }}">{{ k }}: {{ my_schema[k]["name"] }}</label>
            </div>
            {% endfor %}
          </div>
          {% if my_schema.keys() %}
          <button type="submit" class="btn btn-primary">Download</button>
          {% endif %}
        </form>
      </div>
    </div>
  </div>




  <div class="tab-pane fade" id="nav-stat1" role="tabpanel" aria-labelledby="nav-stat1-tab">
    <br />
    <div class="container-fluid">
      <div class="row-fluid">
        <form method="POST" action="{{ url_for('dash.analytics_request_processor', event_id='moving_average') }}">
          <!-- MODIFY ID, NAME props for each form control -->
          <div class="form-row">
            <div class="form-group col-md-2">
              <label for="stat1InputWindowSize">Window size</label>
              <input type="number" class="form-control" id="stat1InputWindowSize" name="stat1InputWindowSize" value=1 min=0 required>
            </div>
          </div>

          <div class="form-group">
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="checkbox" id="exportInlineCheckboxTimeStamp" value="timestamp" disabled checked>
              <label class="form-check-label" for="exportInlineCheckboxTimeStamp">timestamp (UTC)</label>
            </div>

            {% for k in my_schema %}
            {% if my_schema[k]["type"] == "numeric" %}
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="checkbox" id="stat1InlineCheckbox{{ loop.index }}" name="stat1FieldsSel" value="{{ k }}">
              <label class="form-check-label" for="stat1InlineCheckbox{{ loop.index }}">{{ k }}: {{ my_schema[k]["name"] }}</label>
            </div>
            {% endif %}
            {% endfor %}
          </div>
          {% if my_schema.keys() %}
          <button type="submit" class="btn btn-primary">Submit</button>
          {% endif %}
        </form>
      </div>
      <div class="row-fluid">
        <br />
        <h4>Previously submitted jobs</h4>
        <!-- Implement ACCORDION here -->

        <div class="accordion" id="stat1Accordion">
          <div class="card">
            <div class="card-header" id="stat1heading1">
              <h2 class="mb-0">
                <button class="btn btn-link btn-block text-left" type="button" data-toggle="collapse" data-target="#stat1Collapse1" aria-expanded="true" aria-controls="stat1Collapse1">
                  Job id: { id will go here}
                </button>
              </h2>
            </div>
        
            <div id="stat1Collapse1" class="collapse show" aria-labelledby="headingOne" data-parent="#stat1Accordion">
              <div class="card-body">
                { The analytics response will go here }
              </div>
            </div>
          </div>
        </div>


      </div>
    </div>

  </div>






  <div class="tab-pane fade" id="nav-forecasting" role="tabpanel" aria-labelledby="nav-forecasting-tab">
    ...
  </div>
</div>
{% endblock %}